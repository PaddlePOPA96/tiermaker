var oe=Object.defineProperty,pe=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var ee=(r,e,t)=>e in r?oe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,d=(r,e)=>{for(var t in e||(e={}))le.call(e,t)&&ee(r,t,e[t]);if(_)for(var t of _(e))ue.call(e,t)&&ee(r,t,e[t]);return r},g=(r,e)=>pe(r,ce(e));var s=(r,e,t)=>new Promise((a,i)=>{var n=o=>{try{p(t.next(o))}catch(h){i(h)}},u=o=>{try{p(t.throw(o))}catch(h){i(h)}},p=o=>o.done?a(o.value):Promise.resolve(o.value).then(n,u);p((t=t.apply(r,e)).next())});var X=class{},m=X;var b=class b extends m{constructor(t){var a;super();this.cached=!1;if(this.id=t.id,!(t.type in b.typeMap))throw`Unregistered relationship type: ${t.type}`;if(this.type=t.type,this.related=t.related,t.attributes)try{let i=b.typeMap[this.type],n={attributes:t.attributes,id:this.id,type:this.type,relationships:(a=t.relationships)!=null?a:[]};this.cachedData=Reflect.construct(i,[n]),this.cached=!0}catch(i){}}resolve(){return s(this,null,function*(){return this.cached?this.cachedData:b.typeMap[this.type].get(this.id)})}static resolveAll(t){return s(this,null,function*(){if(t.length===0)return[];let a=b.typeMap[t[0].type];return a!==void 0&&a.getMultiple!==void 0?a.getMultiple(t.map(i=>i.id)):yield Promise.all(t.map(i=>i.resolve()))})}static convertType(t,a,i){return a.filter(n=>n.type===t).map(n=>i?new b(g(d({},n),{relationships:[i]})):new b(n))}static createSelfRelationship(t,a){if(!a.id)throw new Error("ID is missing. Did you call this too early in the constructor?");return new b({id:a.id,type:t})}static registerTypes(t,a){if(b.typeMapLocked)throw Error(`Cannot add types ${t} because the Relationship type map has been locked.`);t.forEach(i=>b.typeMap[i]=a)}static lockTypeMap(){b.typeMapLocked=!0}static getRegisteredTypes(){return Object.keys(b.typeMap)}};b.typeMap={},b.typeMapLocked=!1;var j=b,c=j;var G=class G{constructor(e){for(let t in e)this[t]=e[t]}get localString(){if(G.globalLocale in this)return this[G.globalLocale];if("en"in this)return this.en;for(let e of Object.keys(this))if(typeof this[e]=="string")return this[e];return""}static setGlobalLocale(e){if(e.length<2||e.length>8)throw Error(`Locale "${e}" has an invalid length`);G.globalLocale=e}};G.globalLocale="en";var K=G,P=K;var v=class r extends Error{constructor(e){if(typeof e!="string"){let t;"result"in e?t=e.errors:t=e,e=t.map((i,n,u)=>{let p="";return u.length>1&&(p+=`[${n} of ${u.length}] `),p+=`${i.title} (${i.status}, ${i.id}): ${i.detail}. `,p}).join(`
`)}e.includes("36 characters")&&(e+=`

It looks like MangaDex expected a UUID, but you provided a non-UUID string. If you are using Tags, please use Tag.getByName() instead of the literal name.`),super(e),Object.setPrototypeOf(this,r.prototype),this.name="APIResponseError"}};var C=class r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,r.prototype),this.name="AuthError"}};var U=class{};U.useDebugServerValue=!1;function he(r){U.useDebugServerValue=r}function me(){return U.useDebugServerValue}function z(r){U.activeClient=r}function te(){U.activeClient=void 0}function ae(){var r;return(r=U.activeClient)!=null?r:null}function l(a,i){return s(this,arguments,function*(r,e,t={}){let n=U.useDebugServerValue?"https://api.mangadex.dev":"https://api.mangadex.org/",u=re(n,r,e);if(U.activeClient&&!t.noAuth){let M=yield U.activeClient.getSessionToken();t.headers===void 0&&(t.headers={}),t.headers.authorization=`Bearer ${M}`}let p=yield fetch(u,t),o=p.headers.get("content-type");if(!(o!=null&&o.toLowerCase().includes("json"))){let M=`${p.statusText} (${p.status}) Response was an unexpected content type: ${o!=null?o:"Unspecified Type"}.`;try{let y=yield p.text();y.length>128&&(y=y.slice(0,128)),M+=`
Start of Body: ${y}`}catch(y){}throw new v(M)}let h=yield p.json();if("result"in h&&h.result!=="ok")throw new v(h);if(p.status>=400)throw new v(`${p.statusText} (${p.status})`);return h})}function S(r,e,t){return s(this,null,function*(){return(yield l(r,e,t)).data})}function f(n){return s(this,arguments,function*(r,e={},t,a=100,i=10){var R,E;let p=Math.min((R=e.limit)!=null?R:i,1e4),o=(E=e.offset)!=null?E:0;if(o>=1e4||p<=0)return[];o>1e4-Math.min(a,p)&&(p=1e4-o);let h=yield l(r,g(d({},e),{limit:Math.min(p,a)}),t);if(p<=a||h.total<=h.data.length+o)return h.data;p=Math.min(p,h.total);let M=[];for(let q=o+a;q<p;q+=a){let ne=Math.min(p-q,a);M.push(S(r,g(d({},e),{limit:ne,offset:q}),t))}let y=yield Promise.all(M);return h.data.concat(...y)})}function T(u,p){return s(this,arguments,function*(r,e,t={},a="ids",i=100,n){let o=e.map(R=>R instanceof m?R.id:R),h=[];for(let R=0;R<o.length;R+=i)h.push(S(r,g(d({},t),{[a]:o.slice(R,R+i),limit:i}),n));let y=(yield Promise.all(h)).flat();return y.sort((R,E)=>o.indexOf(R.id)-o.indexOf(E.id)),y})}function D(n,u,p){return s(this,arguments,function*(r,e,t,a="POST",i={}){let o=i.headers!==void 0?i.headers:{};return o["Content-Type"]="application/json",l(r,t,{body:JSON.stringify(e),method:a,headers:o})})}function w(n,u,p){return s(this,arguments,function*(r,e,t,a="POST",i={}){return(yield D(r,e,t,a,i)).data})}function se(r,e,t){return s(this,null,function*(){let a=re("https://api.mangadex.network",r,t),i=yield fetch(a,{body:JSON.stringify(e),method:"POST",headers:{"Content-Type":"application/json"}});if(!i.ok)throw new v(`${i.status} ${i.statusText}`)})}function O(n,u,p){return s(this,arguments,function*(r,e,t,a="POST",i={}){let o=new FormData,h=(M,y)=>{typeof y!="string"&&"data"in y&&"name"in y?o.append(M,y.data,y.name):o.append(M,y)};for(let[M,y]of Object.entries(e))y&&(Array.isArray(y)?y.forEach((R,E)=>h(M+E,R)):h(M,y));return yield l(r,t,g(d({},i),{method:a,body:o}))})}function re(r,e,t){let a=e?new URL(e,r):new URL(r);if(!t)return a;for(let[i,n]of Object.entries(t))if(Array.isArray(n))for(let u of n)u instanceof m&&(u=u.id),a.searchParams.append(`${i}[]`,u.toString());else if(typeof n=="object")if(n instanceof m)a.searchParams.append(i,n.id.toString());else{let u=Object.entries(n);for(let[p,o]of u)a.searchParams.append(`${i}[${p}]`,o.toString())}else n!==void 0&&a.searchParams.append(i,n.toString());return a}function V(r){return s(this,null,function*(){try{let e;return r!==void 0&&(e={headers:{authorization:`Bearer ${r}`},noAuth:!0}),(yield l("/auth/check",void 0,e)).isAuthenticated}catch(e){if(e instanceof v)return!1;throw e}})}function Y(r,e){return s(this,null,function*(){let t=new URLSearchParams;for(let[p,o]of Object.entries(e))t.append(p,o);let a=`https://auth.mangadex.${me()?"dev":"org"}`,i=new URL(r,a),n=yield fetch(i,{body:t,method:"POST"});if(n.status>=400)throw new C(`${n.statusText} (${n.status})`);return yield n.json()})}var $=class r extends m{constructor(e){super(),this.id=e.id,this.name=e.attributes.name,this.imageUrl=e.attributes.imageUrl,this.biography=new P(e.attributes.biography),this.twitter=e.attributes.twitter,this.pixiv=e.attributes.pixiv,this.melonBook=e.attributes.melonBook,this.fanBox=e.attributes.fanBox,this.booth=e.attributes.booth,this.nicoVideo=e.attributes.nicoVideo,this.skeb=e.attributes.skeb,this.fantia=e.attributes.fantia,this.tumblr=e.attributes.tumblr,this.youtube=e.attributes.youtube,this.weibo=e.attributes.weibo,this.naver=e.attributes.naver,this.namicomi=e.attributes.namicomi,this.website=e.attributes.website,this.version=e.attributes.version,this.createdAt=new Date(e.attributes.createdAt),this.updatedAt=new Date(e.attributes.updatedAt),this.manga=c.convertType("manga",e.relationships)}static get(e,t){return s(this,null,function*(){return new r(yield S(`/author/${e}`,{includes:t}))})}static search(e){return s(this,null,function*(){return(yield f("/author",e)).map(a=>new r(a))})}static getByQuery(e){return s(this,null,function*(){var a;return(a=(yield this.search(e))[0])!=null?a:null})}static getMultiple(e){return s(this,null,function*(){return(yield T("/author",e)).map(a=>new r(a))})}static create(e){return s(this,null,function*(){return new r(yield w("/author",e))})}static delete(e){return s(this,null,function*(){yield l(`/author/${e}`,void 0,{method:"DELETE"})})}delete(){return s(this,null,function*(){yield r.delete(this.id)})}update(e){return s(this,null,function*(){return new r(yield w(`/author/${this.id}`,g(d({},e),{version:this.version+1}),void 0,"PUT"))})}};var L=class r extends m{constructor(e){var a;super(),this.id=e.id,this.volume=e.attributes.volume,this.fileName=e.attributes.fileName,this.description=e.attributes.description,this.locale=e.attributes.locale,this.version=e.attributes.version,this.createdAt=new Date(e.attributes.createdAt),this.updatedAt=new Date(e.attributes.updatedAt);let t=c.createSelfRelationship("cover_art",this);this.manga=c.convertType("manga",e.relationships,t).pop(),this.url=`https://mangadex.org/covers/${this.manga.id}/${this.fileName}`,this.uploader=(a=c.convertType("user",e.relationships).pop())!=null?a:null}static get(e,t){return s(this,null,function*(){return e instanceof m&&(e=e.id),new r(yield S(`/cover/${e}`,{includes:t}))})}static search(e){return s(this,null,function*(){return(yield f("/cover",e)).map(a=>new r(a))})}static getByQuery(e){return s(this,null,function*(){var a;return(a=(yield this.search(e))[0])!=null?a:null})}static getMultiple(e){return s(this,null,function*(){return(yield T("/cover",e)).map(a=>new r(a))})}static getMangaCovers(e,t){return s(this,null,function*(){if(Array.isArray(e)||(e=[typeof e=="string"?e:e.id]),e.length===0)return[];let a=e.map(i=>typeof i=="string"?i:i.id);return r.search({manga:a,includes:t})})}static delete(e){return s(this,null,function*(){yield l(`/cover/${e}`,void 0,{method:"DELETE"})})}delete(){return s(this,null,function*(){yield r.delete(this.id)})}update(e){return s(this,null,function*(){return new r(yield w(`/cover/${this.id}`,g(d({},e),{version:this.version+1}),void 0,"PUT"))})}static create(e,t){return s(this,null,function*(){typeof e!="string"&&(e=e.id);let a=yield O(`/cover/${e}`,t);return new r(a.data)})}};var I=class r extends m{constructor(e){super(),this.id=e.id,this.name=new P(e.attributes.name),this.description=new P(e.attributes.description),this.group=e.attributes.group,this.version=e.attributes.version}get localName(){return this.name.localString}get localDescription(){return this.description.localString}static getAllTags(){return s(this,null,function*(){if(!r.allTagCache||r.allTagCache.length===0){let e=yield l("/manga/tag");r.allTagCache=e.data.map(t=>new r(t))}return r.allTagCache})}static getByName(e){return s(this,null,function*(){let t=yield this.getAllTags(),a=e.toLowerCase(),i=t.find(n=>Object.values(n.name).some(u=>u.toLowerCase()===a));if(!i)throw new Error(`No tag found with name ${e}`);return i})}static getByNames(e){return s(this,null,function*(){let t=yield this.getAllTags(),a=e.map(i=>i.toLowerCase());return t.filter(i=>Object.values(i.name).some(n=>a.includes(n.toLowerCase())))})}};var Z=class{constructor(e){this.anilist=e!=null&&e.al?`https://anilist.co/manga/${e.al}`:void 0,this.animePlanet=e!=null&&e.ap?`https://www.anime-planet.com/manga/${e.ap}`:void 0,this.bookWalker=e!=null&&e.bw?`https://bookwalker.jp/${e.bw}`:void 0,this.mangaUpdates=e!=null&&e.mu?`https://www.mangaupdates.com/series.html?id=${e.mu}`:void 0,this.novelUpdates=e!=null&&e.nu?`https://www.novelupdates.com/series/${e.nu}`:void 0,this.myAnimeList=e!=null&&e.mal?`https://myanimelist.net/manga/${e.mal}`:void 0,(e==null?void 0:e.kt)!==void 0&&(isNaN(parseInt(e.kt))?this.kitsu=`https://kitsu.io/api/edge/manga?filter[slug]=${e.kt}`:this.kitsu=`https://kitsu.io/api/edge/manga/${e.kt}`),this.amazon=e==null?void 0:e.amz,this.eBookJapan=e==null?void 0:e.ebj,this.raw=e==null?void 0:e.raw,this.officialEnglishTranslation=e==null?void 0:e.engtl,this.cdJapan=e==null?void 0:e.cdj}},ie=Z;var A=class r extends m{constructor(e){super(),this.id=e.id,this.title=e.attributes.title,this.volume=e.attributes.volume,this.chapter=e.attributes.chapter,this.pages=e.attributes.pages,this.translatedLanguage=e.attributes.translatedLanguage,this.uploader=c.convertType("user",e.relationships).pop(),this.externalUrl=e.attributes.externalUrl,this.version=e.attributes.version,this.createdAt=new Date(e.attributes.createdAt),this.publishAt=new Date(e.attributes.publishAt),this.updatedAt=new Date(e.attributes.updatedAt),this.readableAt=new Date(e.attributes.readableAt),this.isExternal=e.attributes.externalUrl!==null,this.manga=c.convertType("manga",e.relationships).pop(),this.groups=c.convertType("scanlation_group",e.relationships),this.isUnavailable=e.attributes.isUnavailable}static get(e,t){return s(this,null,function*(){return new r(yield S(`/chapter/${e}`,{includes:t}))})}static getMultiple(e){return s(this,null,function*(){return(yield T("/chapter",e)).map(a=>new r(a))})}static search(e){return s(this,null,function*(){return(yield f("/chapter",e)).map(a=>new r(a))})}static getByQuery(e){return s(this,null,function*(){var a;return(a=(yield this.search(e))[0])!=null?a:null})}update(e){return s(this,null,function*(){return new r(yield w(`/chapter/${this.id}`,g(d({},e),{version:this.version+1}),void 0,"PUT"))})}static delete(e){return s(this,null,function*(){yield l(`/chapter/${e}`,void 0,{method:"DELETE"})})}delete(){return s(this,null,function*(){yield r.delete(this.id)})}getReadablePages(e=!1,t=!1){return s(this,null,function*(){var n,u;if(this.isExternal)throw new Error("Cannot get readable pages for an external chapter.");let a=yield l(`/at-home/server/${this.id}`,{forcePort443:t});return((u=e&&(n=a.chapter.dataSaver)!=null?n:a.chapter.data)!=null?u:[]).map(p=>`${a.baseUrl}/${e?"data-saver":"data"}/${a.chapter.hash}/${p}`)})}static reportPageURL(e){return s(this,null,function*(){yield se("/report",e)})}static getStatistics(e){return s(this,null,function*(){return(yield l("/statistics/chapter",{chapter:e})).statistics})}getStatistics(){return s(this,null,function*(){return(yield r.getStatistics([this.id]))[this.id]})}};var x=class r extends m{constructor(e){var a;super(),this.id=e.id;let t=c.createSelfRelationship("manga",this);this.altTitles=e.attributes.altTitles.map(i=>new P(i)),this.artists=c.convertType("artist",e.relationships,t),this.authors=c.convertType("author",e.relationships,t),this.availableTranslatedLanguages=e.attributes.availableTranslatedLanguages,this.chapterNumbersResetOnNewVolume=e.attributes.chapterNumbersResetOnNewVolume,this.contentRating=e.attributes.contentRating,this.createdAt=new Date(e.attributes.createdAt),this.description=new P(e.attributes.description),this.isLocked=e.attributes.isLocked,this.lastChapter=e.attributes.lastChapter,this.lastVolume=e.attributes.lastVolume,this.latestUploadedChapter=null,e.attributes.latestUploadedChapter&&(this.latestUploadedChapter=new c({id:e.attributes.latestUploadedChapter,type:"chapter",relationships:[t]})),this.links=new ie(e.attributes.links),this.mainCover=c.convertType("cover_art",e.relationships,t).pop(),this.publicationDemographic=e.attributes.publicationDemographic,this.relatedManga=r.getRelatedManga(e.relationships),this.state=e.attributes.state,this.status=e.attributes.status,this.tags=e.attributes.tags.map(i=>new I(i)),this.title=new P(e.attributes.title),this.updatedAt=new Date(e.attributes.updatedAt),this.version=e.attributes.version,this.year=e.attributes.year,this.originalLanguage=e.attributes.originalLanguage,this.creator=(a=c.convertType("creator",e.relationships).pop())!=null?a:null}static getRelatedManga(e){let t={monochrome:[],main_story:[],adapted_from:[],based_on:[],prequel:[],side_story:[],doujinshi:[],same_franchise:[],shared_universe:[],sequel:[],spin_off:[],alternate_story:[],alternate_version:[],preserialization:[],colored:[],serialization:[]};for(let a of e)a.type==="manga"&&t[a.related].push(new c(a));return t}get localTitle(){return this.title.localString}get localAltTitles(){return this.altTitles.map(e=>e.localString)}get localDescription(){return this.description.localString}static get(e,t){return s(this,null,function*(){return new r(yield S(`/manga/${e}`,{includes:t}))})}static search(e){return s(this,null,function*(){return(yield f("/manga",e)).map(a=>new r(a))})}static getMultiple(e,t){return s(this,null,function*(){return(yield T("/manga",e,t)).map(i=>new r(i))})}static getTotalSearchResults(e){return s(this,null,function*(){return(yield l("/manga",g(d({},e),{limit:1,offset:0}))).total})}static getFeed(e,t){return s(this,null,function*(){return(yield f(`/manga/${e}/feed`,t)).map(i=>new A(i))})}getFeed(e){return s(this,null,function*(){return r.getFeed(this.id,e)})}static updateReadChapters(e,t,a=!1){return s(this,null,function*(){var n,u,p,o;if(!t.read&&!t.unread)return[];let i={chapterIdsRead:(u=(n=t.read)==null?void 0:n.map(h=>typeof h=="string"?h:h.id))!=null?u:[],chapterIdsUnread:(o=(p=t.unread)==null?void 0:p.map(h=>typeof h=="string"?h:h.id))!=null?o:[]};yield D(`/manga/${e}/read`,i,{updateHistory:a})})}updateReadChapters(e,t=!1){return s(this,null,function*(){return r.updateReadChapters(this.id,e,t)})}static getReadChapters(e){return s(this,null,function*(){let t={};for(let n=0;n<e.length;n+=100){let u=yield S("/manga/read",{ids:e.slice(n,n+100),grouped:!0});if(Array.isArray(u))if(e.length===1)u={[typeof e[0]=="string"?e[0]:e[0].id]:u};else throw new v("MangaDex did not respond with a grouped body.");for(let[p,o]of Object.entries(u))p in t?t[p].push(...o):t[p]=o}let a=yield A.getMultiple(Object.values(t).flat()),i={};for(let n in t)i[n]=a.filter(u=>t[n].includes(u.id));return i})}getReadChapters(){return s(this,null,function*(){let e=yield S(`/manga/${this.id}/read`);return yield A.getMultiple(e)})}static getRandom(e){return s(this,null,function*(){let t=yield S("/manga/random",e);return new r(t)})}static getByQuery(e){return s(this,null,function*(){var a;return(a=(yield this.search(e))[0])!=null?a:null})}getCovers(){return s(this,null,function*(){return L.getMangaCovers(this.id)})}static getFollowedManga(){return s(this,arguments,function*(e={limit:1/0,offset:0}){return(yield f("/user/follows/manga",e)).map(a=>new r(a))})}static getUserRatings(e){return s(this,null,function*(){let t=yield l("/rating",{manga:e}),a={};for(let i of e)typeof i!="string"&&(i=i.id),i in t.ratings?a[i]={rating:t.ratings[i].rating,createdAt:new Date(t.ratings[i].createdAt)}:a[i]=null;return a})}getUserRating(){return s(this,null,function*(){var t,a;return(a=(t=(yield r.getUserRatings([this.id]))[this.id])==null?void 0:t.rating)!=null?a:null})}static giveRating(e,t){return s(this,null,function*(){if(t>10||t<1)throw new Error("Rating must be in the range of 1-10 (inclusive).");yield D(`/rating/${e}`,{rating:t})})}giveRating(e){return s(this,null,function*(){yield r.giveRating(this.id,e)})}static removeRating(e){return s(this,null,function*(){yield l(`/rating/${e}`,void 0,{method:"DELETE"})})}removeRating(){return s(this,null,function*(){yield r.removeRating(this.id)})}static getFollowedFeed(e){return s(this,null,function*(){return(yield f("/user/follows/manga/feed",e)).map(a=>new A(a))})}static convertLegacyId(e,t){return s(this,null,function*(){let a=yield w("/legacy/mapping",{type:e,ids:t});return Object.fromEntries(a.map(i=>[i.attributes.legacyId,i.attributes.newId]))})}static getAllReadingStatus(e){return s(this,null,function*(){return(yield l("/manga/status",{status:e})).statuses})}static getReadingStatus(e){return s(this,null,function*(){return(yield l(`/manga/${e}/status`)).status})}getReadingStatus(){return s(this,null,function*(){return yield r.getReadingStatus(this.id)})}static setReadingStatus(e,t){return s(this,null,function*(){yield D(`/manga/${e}/status`,{status:t})})}setReadingStatus(e){return s(this,null,function*(){yield r.setReadingStatus(this.id,e)})}static getRelations(e,t=!1){return s(this,null,function*(){let i=(yield S(`/manga/${e}/relation`,{includes:t?["manga"]:void 0})).flatMap(n=>n.relationships.map(u=>g(d({},u),{related:n.attributes.relation})));return r.getRelatedManga(i)})}getRelations(e=!1){return s(this,null,function*(){return yield r.getRelations(this.id,e)})}static addRelation(e,t,a){return s(this,null,function*(){yield w(`/manga/${e}/relation`,{targetManga:t,relation:a})})}addRelation(e,t){return s(this,null,function*(){yield r.addRelation(this.id,e,t)})}static removeRelation(e,t){return s(this,null,function*(){yield l(`/manga/${e}/relation/${t}`,void 0,{method:"DELETE"})})}removeRelation(e){return s(this,null,function*(){yield r.removeRelation(this.id,e)})}static getStatistics(e){return s(this,null,function*(){return(yield l("/statistics/manga",{manga:e})).statistics})}getStatistics(){return s(this,null,function*(){return(yield r.getStatistics([this.id]))[this.id]})}static getDraft(e,t){return s(this,null,function*(){return new r(yield S(`/manga/draft/${e}`,{includes:t}))})}static searchDrafts(e){return s(this,null,function*(){return(yield f("/manga/draft",e)).map(a=>new r(a))})}static commitDraft(e,t){return s(this,null,function*(){let a=yield w(`/manga/draft/${e}/commit`,t);return new r(a)})}static create(e){return s(this,null,function*(){return new r(yield w("/manga",e))})}static delete(e){return s(this,null,function*(){yield l(`/manga/${e}`,void 0,{method:"DELETE"})})}delete(){return s(this,null,function*(){yield r.delete(this.id)})}update(e){return s(this,null,function*(){return new r(yield w(`/author/${this.id}`,g(d({},e),{version:this.version+1}),void 0,"PUT"))})}static getAggregate(e,t,a){return s(this,null,function*(){return(yield l(`/manga/${e}/aggregate`,{groups:t,translatedLanguage:a})).volumes})}getAggregate(e,t){return s(this,null,function*(){return r.getAggregate(this.id,e,t)})}static changeFollowship(e,t=!0){return s(this,null,function*(){yield l(`/manga/${e}/follow`,void 0,{method:t?"POST":"DELETE"})})}changeFollowship(e=!0){return s(this,null,function*(){yield r.changeFollowship(this.id,e)})}};var B=class r extends m{constructor(e){super(),this.id=e.id,this.username=e.attributes.username,this.roles=e.attributes.roles,this.version=e.attributes.version,this.groups=c.convertType("scanlation_group",e.relationships)}static get(e){return s(this,null,function*(){return new r(yield S(`/user/${e}`))})}static search(e){return s(this,null,function*(){return(yield f("/user",e)).map(a=>new r(a))})}static getMultiple(e){return s(this,null,function*(){return(yield T("/user",e)).map(a=>new r(a))})}static getByQuery(e){return s(this,null,function*(){var a;return(a=(yield this.search(e))[0])!=null?a:null})}static getLoggedInUser(){return s(this,null,function*(){return new r(yield S("/user/me"))})}static getFollowedUsers(){return s(this,arguments,function*(e={limit:1/0,offset:0}){return(yield f("/user/follows/user",e)).map(a=>new r(a))})}};var F=class r extends m{constructor(e){var a;super(),this.id=e.id,this.name=e.attributes.name,this.altNames=e.attributes.altNames.map(i=>new P(i)),this.website=e.attributes.website,this.ircServer=e.attributes.ircServer,this.ircChannel=e.attributes.ircChannel,this.discord=e.attributes.discord,this.contactEmail=e.attributes.contactEmail,this.description=e.attributes.description,this.twitter=e.attributes.twitter,this.mangaUpdates=e.attributes.mangaUpdates,this.focusedLanguage=e.attributes.focusedLanguage,this.locked=e.attributes.locked,this.official=e.attributes.official,this.inactive=e.attributes.inactive,this.publishDelay=e.attributes.publishDelay,this.version=e.attributes.version,this.createdAt=new Date(e.attributes.createdAt),this.updatedAt=new Date(e.attributes.updatedAt);let t=c.createSelfRelationship("scanlation_group",this);this.leader=(a=c.convertType("leader",e.relationships,t).pop())!=null?a:null,this.members=c.convertType("member",e.relationships,t),this.exLicensed=e.attributes.exLicensed,this.verified=e.attributes.verified}static get(e){return s(this,null,function*(){return new r(yield S(`/group/${e}`))})}static search(e){return s(this,null,function*(){return(yield f("/group",e)).map(a=>new r(a))})}static getMultiple(e){return s(this,null,function*(){return(yield T("/group",e)).map(a=>new r(a))})}static getByQuery(e){return s(this,null,function*(){var a;return(a=(yield this.search(e))[0])!=null?a:null})}static create(e){return s(this,null,function*(){return new r(yield w("/group",e))})}static delete(e){return s(this,null,function*(){yield l(`/group/${e}`,void 0,{method:"DELETE"})})}delete(){return s(this,null,function*(){yield r.delete(this.id)})}update(e){return s(this,null,function*(){return new r(yield w(`/group/${this.id}`,g(d({},e),{version:this.version+1}),void 0,"PUT"))})}static changeFollowship(e,t=!0){return s(this,null,function*(){yield l(`/group/${e}/follow`,void 0,{method:t?"POST":"DELETE"})})}changeFollowship(e=!0){return s(this,null,function*(){yield r.changeFollowship(this.id,e)})}static getStatistics(e){return s(this,null,function*(){return(yield l("/statistics/group",{group:e})).statistics})}getStatistics(){return s(this,null,function*(){return(yield r.getStatistics([this.id]))[this.id]})}static getFollowedGroups(){return s(this,arguments,function*(e={limit:1/0,offset:0}){return(yield f("/user/follows/group",e)).map(a=>new r(a))})}};var W=class r extends m{constructor(e){super(),this.updateData(e)}updateData(e){"data"in e&&(e=e.data),this.id=e.id,this.isCommitted=e.attributes.isCommitted,this.isProcessed=e.attributes.isProcessed,this.isDeleted=e.attributes.isDeleted,this.version=e.attributes.version,this.createdAt=new Date(e.attributes.createdAt),this.updatedAt=new Date(e.attributes.updatedAt),this.uploader=c.convertType("user",e.relationships).pop(),this.manga=c.convertType("manga",e.relationships).pop(),this.groups=c.convertType("scanlation_group",e.relationships),this.pages=e.relationships.filter(t=>t.type==="upload_session_file").map(t=>{if(!t.attributes)throw new Error("MangaDex did not return session file attributes in a relationship. Did you forget a reference expansion (ie includes[])?");return new H({id:t.id,attributes:t.attributes,type:"upload_session_file"})}),this.pages.sort((t,a)=>t.num-a.num)}static begin(i){return s(this,arguments,function*(e,t=[],a=!1){return a&&(yield r.cancelCurrentSession()),new r(yield D("/upload/begin",{manga:typeof e=="string"?e:e.id,groups:t.map(n=>typeof n=="string"?n:n.id)},{includes:["upload_session_file"]}))})}static beginChapterEdit(e,t=!1){return s(this,null,function*(){return t&&(yield r.cancelCurrentSession()),new r(yield D(`/upload/begin/${e.id}`,{version:e.version},{includes:["upload_session_file"]}))})}static getCurrentSession(){return s(this,null,function*(){return new r(yield l("/upload",{includes:["upload_session_file"]}))})}static cancelCurrentSession(){return s(this,null,function*(){let e;try{e=yield r.getCurrentSession()}catch(t){}e&&(yield e.close())})}close(){return s(this,null,function*(){yield l(`/upload/${this.id}`,void 0,{method:"DELETE"}),this.isDeleted=!0})}commit(e,t){return s(this,null,function*(){t?t=t.map(a=>typeof a=="string"?a:a.id):t=this.pages.map(a=>a.id),this.updateData(yield D(`/upload/${this.id}/commit`,{chapterDraft:e,pageOrder:t},{includes:["upload_session_file"]}))})}uploadPages(e){return s(this,null,function*(){let t=Math.max(...this.pages.map(o=>o.num),0),a=e.map((o,h)=>({data:o,name:(h+t).toString()})),i=[];for(;a.length>0;)i.push(O(`/upload/${this.id}`,{files:a.splice(0,10)}));let n=yield Promise.all(i),u=n.flatMap(o=>{var h;return(h=o.errors)!=null?h:[]});if(u.length>0)throw new v(u);let p=n.flatMap(o=>{var h;return(h=o.data)!=null?h:[]}).map(o=>new H(o));p.sort((o,h)=>o.num-h.num),this.pages.push(...p)})}deletePages(e){return s(this,null,function*(){let t=e.map(a=>typeof a=="string"?a:a.id);yield D(`/upload/${this.id}/batch`,t,void 0,"DELETE"),this.pages=this.pages.filter(a=>!t.includes(a.id))})}},H=class extends m{constructor(e){super(),this.id=e.id,this.originalFileName=e.attributes.originalFileName,this.fileHash=e.attributes.fileHash,this.fileSize=e.attributes.fileSize,this.mimeType=e.attributes.mimeType,this.source=e.attributes.source,this.version=e.attributes.version,this.num=parseInt(this.originalFileName),isNaN(this.num)&&(this.num=parseInt(this.fileHash,16)),isNaN(this.num)&&(this.num=1e3)}};var k=class r{constructor(e){this.data=e}getSessionToken(){return s(this,null,function*(){if(Date.now()>this.data.refreshExpiration)throw new C("Refresh token has expired. Please login again.");if(Date.now()>this.data.accessExpiration&&(yield this.refreshTokens(),!(yield V(this.data.accessToken))))throw new C("Failed to validate auth token. Please login again.");return this.data.accessToken})}refreshTokens(){return s(this,null,function*(){let e=yield Y("/realms/mangadex/protocol/openid-connect/token",{grant_type:"refresh_token",refresh_token:this.data.refreshToken,client_id:this.data.clientId,client_secret:this.data.clientSecret});this.data.accessToken=e.access_token,this.data.accessExpiration=Q(e.expires_in),this.data.refreshToken=e.refresh_token,this.data.refreshExpiration=Q(e.refresh_expires_in)})}static login(e,t=!0){return s(this,null,function*(){let a=yield Y("/realms/mangadex/protocol/openid-connect/token",{grant_type:"password",username:e.username,password:e.password,client_id:e.clientId,client_secret:e.clientSecret}),i=new r(g(d({},e),{accessToken:a.access_token,accessExpiration:Q(a.expires_in),refreshToken:a.refresh_token,refreshExpiration:Q(a.refresh_expires_in)}));return t&&z(i),i})}};function Q(r){return r*1e3+Date.now()-5e3}var N=class r{constructor(e){this.data=e}getSessionToken(){return s(this,null,function*(){if(Date.now()-this.data.timestamp>=894e3&&(yield this.refreshTokens(),!(yield this.checkSessionToken())))throw new C("Failed to validate auth token. Please login again.");return this.data.session})}setActive(){z(this)}static login(e,t){return s(this,null,function*(){let a=yield D("/auth/login",{username:e,password:t}),i=a.token.session,n=a.token.refresh;if(!i||!n)throw new C("MangaDex did not return auth tokens.");let u=new r({session:i,refresh:n,timestamp:Date.now()});return u.setActive(),u})}refreshTokens(){return s(this,null,function*(){let e=yield D("/auth/refresh",{token:this.data.refresh},void 0,"POST",{noAuth:!0});if(!e.token)throw new C(`Failed to refresh auth tokens, MangaDex did not return any. ${e.message}`);let t=e.token.session,a=e.token.refresh;if(!t||!a)throw new C(`MangaDex did not return auth tokens. ${e.message}`);this.data={session:t,refresh:a,timestamp:Date.now()}})}checkSessionToken(){return V(this.data.session)}};var J=class r extends m{constructor(e){super(),this.id=e.id,this.name=e.attributes.name,this.visibility=e.attributes.visibility,this.version=e.attributes.version,this.creator=c.convertType("user",e.relationships).pop(),this.manga=c.convertType("manga",e.relationships)}static get(e){return s(this,null,function*(){return new r(yield S(`/list/${e}`))})}static create(e){return s(this,null,function*(){return new r(yield w("/list",e))})}static delete(e){return s(this,null,function*(){yield l(`/list/${e}`,void 0,{method:"DELETE"})})}delete(){return s(this,null,function*(){yield r.delete(this.id)})}update(e){return s(this,null,function*(){var t;return new r(yield w(`/list/${this.id}`,g(d({},e),{name:(t=e.name)!=null?t:this.name,version:this.version+1}),void 0,"PUT"))})}static follow(e){return s(this,null,function*(){yield l(`/list/${e}/follow`,void 0,{method:"POST"})})}follow(){return s(this,null,function*(){yield r.follow(this.id)})}static unfollow(e){return s(this,null,function*(){yield l(`/list/${e}/follow`,void 0,{method:"DELETE"})})}unfollow(){return s(this,null,function*(){yield r.unfollow(this.id)})}static addManga(e,t){return s(this,null,function*(){typeof t!="string"&&(t=t.id),yield l(`/manga/${t}/list/${e}`,void 0,{method:"POST"})})}addManga(e){return s(this,null,function*(){yield r.addManga(this.id,e)})}static removeManga(e,t){return s(this,null,function*(){typeof t!="string"&&(t=t.id),yield l(`/manga/${t}/list/${e}`,void 0,{method:"DELETE"})})}removeManga(e){return s(this,null,function*(){yield r.removeManga(this.id,e)})}static getLoggedInUserLists(e=1/0,t=0){return s(this,null,function*(){return(yield f("/user/list",{limit:e,offset:t})).map(i=>new r(i))})}static getUserLists(e,t=1/0,a=0){return s(this,null,function*(){return typeof e!="string"&&(e=e.id),(yield f(`/user/${e}/list`,{limit:t,offset:a})).map(n=>new r(n))})}static getFeed(e,t){return s(this,null,function*(){return(yield f(`/list/${e}/feed`,t)).map(i=>new A(i))})}getFeed(e){return s(this,null,function*(){return yield r.getFeed(this.id,e)})}static getFollowedLists(e=1/0,t=0){return s(this,null,function*(){return(yield f("/user/follows/list",{limit:e,offset:t})).map(i=>new r(i))})}changeVisibility(e){return s(this,null,function*(){return yield this.update({visibility:e})})}rename(e){return s(this,null,function*(){return yield this.update({name:e})})}updateMangaList(e){return s(this,null,function*(){return e=e.map(t=>typeof t=="string"?t:t.id),yield this.update({manga:e})})}};c.getRegisteredTypes().length===0&&(c.registerTypes(["manga"],x),c.registerTypes(["author","artist"],$),c.registerTypes(["cover_art"],L),c.registerTypes(["chapter"],A),c.registerTypes(["user","member","leader","creator"],B),c.registerTypes(["scanlation_group"],F),c.lockTypeMap());var Qt=P.setGlobalLocale,Jt=c.resolveAll,Xt=x.convertLegacyId,Kt=N.login,Zt=k.login,ea=te,ta=ae;export{$ as Author,A as Chapter,L as Cover,F as Group,N as LegacyAuthClient,J as List,x as Manga,k as PersonalAuthClient,I as Tag,W as UploadSession,B as User,Xt as convertLegacyId,ta as getCurrentAuthClient,Kt as login,Zt as loginPersonal,ea as logout,Jt as resolveArray,Qt as setGlobalLocale,he as useDebugServer};
//# sourceMappingURL=index.mjs.map